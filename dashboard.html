<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Dashboard</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 text-gray-800 min-h-screen">
  <header class="bg-white shadow p-4 flex justify-between items-center">
    <h1 class="text-xl font-bold">ðŸ“„ My Documents</h1>
    <button id="logoutBtn" class="text-red-500 hover:underline">Log out</button>
  </header>

  <main class="max-w-4xl mx-auto py-10 px-4">
    <h2 class="text-2xl font-semibold mb-6">Uploaded Documents</h2>
    <div id="documentsList" class="space-y-6"></div>
  </main>

  <script>
    document.addEventListener('DOMContentLoaded', async () => {
      const token = localStorage.getItem('token');
      const list = document.getElementById('documentsList');

      if (!token) {
        list.innerHTML = '<p class="text-red-600">You are not logged in.</p>';
        return;
      }

      try {
        const res = await fetch('http://localhost:5001/api/dashboard', {
          headers: { 'Authorization': `Bearer ${token}` }
        });

        const docs = await res.json();

        if (docs.length === 0) {
          list.innerHTML = '<p>No documents uploaded yet.</p>';
          return;
        }

        docs.forEach(doc => {
          const div = document.createElement('div');
          div.className = 'p-4 bg-white border border-gray-200 rounded shadow';

          div.innerHTML = `
            <p><strong>Uploaded:</strong> ${new Date(doc.createdAt).toLocaleString()}</p>
            <p class="mt-2 text-gray-700">${doc.originalText.slice(0, 200)}...</p>
            <div class="mt-4">
              ${doc.isPaid
                ? `<a href="/access.html" onclick="localStorage.setItem('fullExplanation', \`${doc.explanation.replace(/`/g, '\`')}\`)" class="text-blue-600 underline">View Full Explanation</a>`
                : `<span class="text-red-500">Not paid</span>`}
            </div>
          `;

          list.appendChild(div);
        });
      } catch (err) {
        console.error(err);
        list.innerHTML = '<p class="text-red-600">Error loading documents.</p>';
      }
    });

    document.getElementById('logoutBtn').addEventListener('click', () => {
      localStorage.removeItem('token');
      window.location.href = '/';
    });
  </script>
</body>
</html>
